<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Avango Primer - Avango concepts - Essential classes</title>
<link rel="stylesheet" type="text/css" href="screen.css" />
</head>
<body>

<!-- Start page contents -->

<h2>Module: avango-connect</h2>
<p>
The module "avango-connect" provides the functionality to connect fields across the network.
This is only a very lightweight mechanism with limited capabilities. More sophisticated mechanisms are provided by the avango-core module.
For the communication, a simple ASCII protocol is used which makes it easy to use avango-connect as a bridge to non-AVANGO applications.
As a convenience, there is a directory in the AVANGO source code which contains an implementation of avango-connect which is written in C#.
</p>

<h3>Input and Ouput nodes</h3>
<p>
To connect fields across the network, it is not possible to connect them directly with the standard field connection mechanism.
Instead, proxy nodes are needed which act as the network interface. There are two proxy node types: an InputNode is acting as an
input interface and an OutputNode is acting as an output interface. To define an interface, a class must be derived from one of
these node types. Changes in the data of one of the fields contained in the derived class will be exchanged across the network with
the fields of another node on the other side, which is derived from the opposite proxy node type. This way, a connection between
fields with the same name is established.
</p>

<img src="media/avango-connect.png" />

<p>
Because of the simple design of avango-connect, only a small set of field types are supported and there is no generic mechanism
to transmit every possible field type that can be created with AVANGO. If there is a need for other field types, you have to
write dedicated code for it to enhance avango-connect. But this should only be done, if that field type is very generic.
If you need more advanced functionality, using the distribution feature of avango-core is probably a better place to start.
</p>

<p>
The following list shows the supported field types. At this time, there is only a small subset of the existing types,
which grows on demand.
<ul>
	<li>SFBool</li>
	<li>SFInt</li>
	<li>SFFloat</li>
	<li>SFDouble</li>
	<li>SFString</li>
	<li>SFVec4</li>
	<li>SFMatrix</li>
	<li>MFInt</li>
	<li>MFString</li>
	<li>MFVec2</li>
	<li>MFVec3</li>
	<li>MFMatrix</li>
</ul>
</p>

<pre class="snippet">
# a node that receives data
class Input(avango.connect.InputNode):
    Text = avango.SFString()

# a node that sends data
class Output(avango.connect.OutputNode):
    Text = avango.SFString()
</pre>

<ul class="classlist">
	<li>avango.connect.InputNode</li>
	<li>avango.connect.OutputNode</li>
</ul>

<h3>Implementing the server side</h3>
<p>
On the server side, the only thing to do is to create a Server object and assign it to the input and output nodes.
At this time, it is only allowed to use no more than one single input and output node, each. Otherwise the behavior is undefined.<br>
The <b>Server node</b> must be created by the <b>listening host</b>.
</p>

<pre class="snippet">
# a node that receives data (from a client)
class Input(avango.connect.InputNode):
    Text = avango.SFString()

# a node that sends data (to a client)
class Output(avango.connect.OutputNode):
    Text = avango.SFString()

server = avango.connect.Server(port=19901)

input_node = Input()
output_node = Output()

input_node.set_stream(server)
output_node.set_stream(server)
</pre>

<ul class="classlist">
	<li>avango.connect.Server</li>
</ul>


<h3>Implementing the client side</h3>
<p>
On the client side, the only thing to do is to create a "Client" object and assign it to the input and output nodes.
At this time, it is only allowed to use no more than one single input and output node, each. Otherwise the behavior is undefined.<br>
The <b>Client node</b> must be created by the <b>connecting host</b>.
</p>

<pre class="snippet">
# a node that receives data (from a server)
class Input(avango.connect.InputNode):
    Text = avango.SFString()

# a node that sends data (to a server)
class Output(avango.connect.OutputNode):
    Text = avango.SFString()

client = avango.connect.Client(host="localhost", port=19901)

input_node = Input()
output_node = Output()

input_node.set_stream(client)
output_node.set_stream(client)
</pre>

<ul class="classlist">
	<li>avango.connect.Client</li>
</ul>

<h3>Network protocol</h3>
<p>
The values of the fields are sent over a TCP connection with a simple stream based text protocol.
Every line of text carries the information of one single field and ends in a line feed (ASCII code 0x0a).
The different parts of a line are separated by NUL characters (ASCII code 0x00).

<pre class="example">
Text<b>&lt;NUL&gt;</b>SFString<b>&lt;NUL&gt;</b>This is a test<b>&lt;LF&gt;</b>
Translation<b>&lt;NUL&gt;</b>SFVec4<b>&lt;NUL&gt;</b>1<b>&lt;NUL&gt;</b>2<b>&lt;NUL&gt;</b>3<b>&lt;NUL&gt;</b>4<b>&lt;LF&gt;</b>
</pre>

In this example, the information about two fields is sent:
<ul>
	<li>A field called "Text" of type "SFString" containing the text "This is a text"</li>
	<li>A field called "Translation" of type "SFVec4" containing the value "(1, 2, 3, 4)".</li>
</ul>

</p>

<!-- End page contents -->

</body>
</html>
